Many thanks to ZWO's support team for this. Not many helpdesks would walk you through recompiling your linux kernel.

If your EFW is not recognised in a recent (mostly Debian/Ubuntu flavoured) linux and `dmesg` shows a -22 error when you insert it, you may be able to get it to work again by reverting or rebuilding your kernel.

The fix is scheduled for an upcoming kernel release in https://github.com/torvalds/linux/commit/f28beb69c51517aec7067dfb2074e7c751542384 and was included in Debian 13's `6.12.69+deb13-amd64` and appears to be in the mainline 6.12.69 release.

On Raspberry pi you want to be using the linux-image-6.12.25 version of the kernel, e.g.

```
sudo apt install --reinstall linux-image-6.12.25+rpt-rpi-v8
sudo cp /boot/vmlinuz-6.12.25+rpt-rpi-v8 /boot/firmware/kernel-stable.img
sudo cp /boot/initrd.img-6.12.25+rpt-rpi-v8 /boot/firmware/initramfs-stable
```

then edit `/boot/firmware/config.txt` to have this line

```
kernel=kernel-stable.img
```

and reboot. To go back to the mainline kernel, simply remove that `kernel=` line and reboot. Remove the older kernel entirely with

```
sudo apt remove linux-image-6.12.25+rpt-rpi-v8
sudo rm /boot/firmware/kernel-stable.img
sudo rm /boot/firmware/initramfs-stable
```

If you need to rebuild your kernel on Debian, follow these instructions:

```
sudo apt install \
  debhelper python3-dacite \
  build-essential devscripts fakeroot quilt \
  bc bison flex rsync \
  libncurses-dev libssl-dev libelf-dev libudev-dev \
  libpci-dev libcap-dev libcap-ng-dev libnuma-dev \
  libzstd-dev libdw-dev libunwind-dev \
  libslang2-dev libnewt-dev libwrap0-dev libaudit-dev \
  libtraceevent-dev libtracefs-dev libbabeltrace-dev libopencsd-dev \
  libperl-dev kernel-wedge gettext po-debconf intltool-debian \
  autopoint diffstat ed dwarves

apt source linux

cd linux-*
patch -p0 < ~/luddcam/libasi/linux-kernel-efw.patch

export DEB_BUILD_PROFILES="pkg.linux.nodoc pkg.linux.nokerneldbg pkg.linux.nokerneldbginfo"
export MAKEFLAGS=-j"$(nproc)"

sed -i '1s/[)]/~zwo)/' debian/changelog
sed -i '1s/ trixie;/ UNRELEASED;/' debian/changelog

debian/rules source
DEB_RULES_REQUIRES_ROOT=no make -f debian/rules.gen binary-arch_amd64_none_amd64
```
